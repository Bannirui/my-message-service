<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.github.bannirui.mms.dal.mapper.ConsumerMapper" >

    <select id="extTopicAndEnvsByConsumerId" resultType="com.github.bannirui.mms.dal.model.ConsumerExtTopicAndEnv">
        select
        consumer.id as consumerId,
        consumer.name as consumerName,
        consumer.user_id as consumerUserId,
        consumer.app_id as consumerAppId,
        consumer.status as consumerStatus,
        consumer.remark as consumerRemark,
        consumer.topic_id as topicId,
        consumer.consumer_broadcast as consumerBroadcast,
        consumer.consumer_from_min as consumerFromMin,
        topic.name as topicName,
        topic.cluster_type as topicType,
        env.id as envId,
        env.sort_id as envSort,
        env.name as envName,
        server.name as clusterName
        from consumer
        left join topic on topic.id = consumer.topic_id
        left join topic_ref on topic_ref.topic_id = topic.id
        left join env on env.id = topic_ref.env_id
        left join server on server.id=topic_ref.server_id
        where consumer.id = #{consumerId}
    </select>
    <select id="extTopicAndEnvsByConsumerIds" resultType="com.github.bannirui.mms.dal.model.ConsumerExtTopicAndEnv">
        select
        consumer.id as consumerId,
        consumer.name as consumerName,
        consumer.user_id as consumerUserId,
        consumer.app_id as consumerAppId,
        consumer.status as consumerStatus,
        consumer.remark as consumerRemark,
        consumer.topic_id as topicId,
        consumer.consumer_broadcast as consumerBroadcast,
        consumer.consumer_from_min as consumerFromMin,
        topic.name as topicName,
        topic.cluster_type as topicType,
        env.id as envId,
        env.sort_id as envSort,
        env.name as envName,
        server.name as clusterName
        from consumer
        left join topic on topic.id = consumer.topic_id
        left join topic_ref on topic_ref.topic_id = topic.id
        left join env on env.id = topic_ref.env_id
        left join server on server.id=topic_ref.server_id
        where consumer.id in
        <foreach collection="consumerIds" item="consumerId" open="(" separator="," close=")">
            #{consumerId}
        </foreach>
    </select>
</mapper>